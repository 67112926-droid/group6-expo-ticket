<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„ GROUP6 EXPO ç”µå­ç¥¨</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 16px;
      background: #050505;
      color: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    .container {
      width: 100%;
      max-width: 480px;
      margin: auto;
      background: #111;
      border-radius: 18px;
      padding: 18px 16px 20px;
      box-shadow: 0 14px 34px rgba(0, 0, 0, 0.75);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .expo-title {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.06em;
    }

    .back-btn {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #181818;
      color: #f5f5f5;
      cursor: pointer;
    }

    .hello { font-size: 14px; }

    .highlight-name {
      font-weight: 700;
      color: #f6c453;
    }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 10px;
      background: #000;
      cursor: pointer;
      margin-top: 6px;
      display: block;
    }

    .hint {
      font-size: 12px;
      color: #ccc;
      text-align: center;
      line-height: 1.5;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .btn {
      width: 100%;
      padding: 9px 0;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-download {
      background: linear-gradient(135deg, #f6c453, #f2a93b);
      color: #151515;
    }

    .btn-download:active { transform: translateY(1px); }

    .btn-seat {
      background: #232323;
      color: #f5f5f5;
      border: 1px solid #333;
    }

    @media (min-width: 768px) {
      body { padding: 36px 0; }
      .container { max-width: 520px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <div class="expo-title">GROUP6 EXPO 2025</div>
      <button class="back-btn" onclick="history.back()">è¿”å›ä¿®æ”¹åå­—</button>
    </div>

    <div class="hello">
      æ¬¢è¿ä½ ï¼Œ<span class="highlight-name" id="nameDisplay"></span>
    </div>

    <canvas id="ticketCanvas"></canvas>

    <div class="hint">
      ğŸ‘‰ ç‚¹å‡»ä¸Šæ–¹ç”µå­ç¥¨ï¼Œå¯æŸ¥çœ‹ä¼šåœºæµ·æŠ¥ä¸åº§ä½å›¾ã€‚<br />
      ä¹Ÿå¯ä»¥ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¸‹è½½ä½ çš„ä¸“å±ç”µå­ç¥¨ã€‚
    </div>

    <div class="actions">
      <button class="btn btn-download" id="downloadBtn">
        ä¸‹è½½è¿™å¼ ç”µå­ç¥¨
      </button>
      <button class="btn btn-seat" id="seatBtn">
        æŸ¥çœ‹ä¼šåœºæµ·æŠ¥ä¸åº§ä½å›¾
      </button>
    </div>
  </div>

  <script>
    // ç­‰æ•´é¡µåŠ è½½å®Œå†æ‰§è¡Œï¼Œé¿å…æ‰¾ä¸åˆ° canvas ç­‰é—®é¢˜
    window.addEventListener("load", function () {
      // â‘  è§£æ URL é‡Œçš„ ?name=...
      function getNameFromUrl() {
        var search = window.location.search || "";
        if (search.indexOf("?") === 0) {
          search = search.substring(1);
        }
        var pairs = search.split("&");
        for (var i = 0; i < pairs.length; i++) {
          var parts = pairs[i].split("=");
          if (parts[0] === "name") {
            try {
              return decodeURIComponent(parts[1] || "");
            } catch (e) {
              return parts[1] || "";
            }
          }
        }
        return "";
      }

      var name = getNameFromUrl();
      if (!name) {
        name = "Visitor"; // æ²¡æœ‰ä¼ åå­—å°±ç”¨é»˜è®¤
      }
      document.getElementById("nameDisplay").textContent = name;

      // â‘¡ è·å– canvas
      var canvas = document.getElementById("ticketCanvas");
      if (!canvas) {
        alert("æ‰¾ä¸åˆ° ticketCanvas å…ƒç´ ï¼Œè¯·æ£€æŸ¥ id æ˜¯å¦è¢«æ”¹åŠ¨ã€‚");
        return;
      }
      var ctx = canvas.getContext("2d");
      if (!ctx) {
        alert("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ canvasã€‚");
        return;
      }

      // â‘¢ åŠ è½½ç¥¨é¢èƒŒæ™¯å›¾
      var baseImage = new Image();

      baseImage.onload = function () {
        var w = baseImage.naturalWidth || baseImage.width;
        var h = baseImage.naturalHeight || baseImage.height;

        canvas.width = w;
        canvas.height = h;

        ctx.clearRect(0, 0, w, h);
        ctx.drawImage(baseImage, 0, 0, w, h);

        // åœ¨ VISTOR ä½ç½®å†™åå­—ï¼ˆä½ æƒ³å¾®è°ƒå¯ä»¥æ”¹è¿™ä¸¤ä¸ªæ•°ï¼‰
        ctx.font = 'bold 20px "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif';
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";

        var x = 55;   // æ¨ªåæ ‡
        var y = 115;  // çºµåæ ‡

        ctx.fillText(name, x, y);
      };

      baseImage.onerror = function () {
        alert("âš ï¸ æ— æ³•åŠ è½½ç¥¨.jpgï¼Œè¯·ç¡®è®¤ï¼š\n1ï¼‰ticket.html ä¸ ç¥¨.jpg åœ¨åŒä¸€æ–‡ä»¶å¤¹\n2ï¼‰æ–‡ä»¶åæ­£å¥½æ˜¯ï¼šç¥¨.jpgï¼ˆå¤§å°å†™ä¸€è‡´ï¼‰");
      };

      // â˜…â˜… è¿™é‡Œçš„æ–‡ä»¶åå¿…é¡»å’Œä½ æ–‡ä»¶å¤¹é‡Œçš„èƒŒæ™¯å›¾åå­—ä¸€æ¨¡ä¸€æ · â˜…â˜…
      baseImage.src = "ç¥¨.jpg";

      // â‘£ æ‰“å¼€åº§ä½å›¾æµ·æŠ¥
      function openSeatPoster() {
        // ä¸ ticket.html åœ¨åŒä¸€æ–‡ä»¶å¤¹çš„æµ·æŠ¥å›¾ç‰‡
        window.location.href = "æµ·æŠ¥.jpg";
      }

      canvas.addEventListener("click", openSeatPoster);
      document.getElementById("seatBtn").addEventListener("click", openSeatPoster);

      // â‘¤ ä¸‹è½½ç”µå­ç¥¨
      document.getElementById("downloadBtn").addEventListener("click", function () {
        var link = document.createElement("a");
        link.download = "group6-expo-ticket.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    });
  </script>
</body>
</html>
